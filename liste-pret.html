<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Liste pr&ecirc;t</title>
  </head>
  <body>
    <h1>Liste des pr&ecirc;ts</h1>

    <table id="table-pret" border="1">
      <thead>
        <tr>
          <th>ID</th>
          <th>Client</th>
          <th>ID Type Pr&ecirc;t</th>
          <th>Montant emprunt&eacute;</th>
          <th>Date d&eacute;but</th>
          <th>Date fin</th>
          <th>ID Etat Validation</th>
          <th>Date cr&eacute;ation</th>
          <th>Date validation</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <script>
      const apiBase = "http://localhost:8000/ws";
      
      function ajax(method, url, data, callback) {
        const xhr = new XMLHttpRequest();
        xhr.open(method, apiBase + url, true);
        xhr.setRequestHeader(
          "Content-Type",
          "application/x-www-form-urlencoded"
        );
        xhr.onreadystatechange = () => {
          if (xhr.readyState === 4 && xhr.status === 200) {
            callback(JSON.parse(xhr.responseText));
          }
        };
        xhr.send(data);
      }

      function chargerPret() {
        ajax("GET", "/pret", null, (data) => {
          const tbody = document.querySelector("#table-pret tbody");
          tbody.innerHTML = "";
          data.forEach((e) => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
            <td>${e.id}</td>
            <td>${e.client}</td>
            <td>${e.type_pret_id}</td>
            <td>${e.montant_emprunt}</td>
            <td>${e.date_debut}</td>
            <td>${e.date_fin}</td>
            <td>${e.id_etat_validation}</td>
            <td>${e.date_creation}</td>
            <td>${e.date_validation}</td>
            <td>
              <button onclick='exportPdf(${e.id})'>Exporter en PDF</button>
            </td>
          `;
            tbody.appendChild(tr);
          });
        });
      }

    function exportPdf(pretId) {
        window.location.href = `http://localhost:8000/ws/export/${pretId}`;
    }

      chargerPret();
    </script>
  </body>
</html>
