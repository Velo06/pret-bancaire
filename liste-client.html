<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Gestion des Clients</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
        }
        input, button {
            margin: 5px;
            padding: 5px;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <h1>Gestion des Clients</h1>

    <div>
        <input type="hidden" id="id" />
        <input type="text" id="nom" placeholder="Nom" />
        <input type="text" id="username" placeholder="Username" />
        <input type="email" id="email" placeholder="Email" />
        <input type="text" id="telephone" placeholder="T√©l√©phone" />
        <button onclick="ajouterOuModifierClient()">Ajouter / Modifier</button>
    </div>

    <table id="table-clients">
        <thead>
            <tr>
                <th>ID</th>
                <th>Nom</th>
                <th>Username</th>
                <th>Email</th>
                <th>T√©l√©phone</th>
                <th>R√¥le</th>
                <th>Statut</th>
                <th>Date Inscription</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        const apiBase = "http://localhost:8000/ws";
        
        function ajax(method, url, data, callback) {
            const xhr = new XMLHttpRequest();
            xhr.open(method, apiBase + url, true);
            xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
            xhr.onreadystatechange = () => {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    callback(JSON.parse(xhr.responseText));
                }
            };
            xhr.send(data);
        }

        function chargerClients() {
            ajax("GET", "/clients", null, (data) => {
                const tbody = document.querySelector("#table-clients tbody");
                tbody.innerHTML = "";
                data.forEach((client) => {
                    const tr = document.createElement("tr");
                    tr.innerHTML = `
                        <td>${client.id}</td>
                        <td>${client.nom}</td>
                        <td>${client.username}</td>
                        <td>${client.email}</td>
                        <td>${client.telephone}</td>
                        <td>${client.role_nom}</td>
                        <td>${client.statut_nom}</td>
                        <td>${new Date(client.date_inscription).toLocaleDateString()}</td>
                        <td>
                            <button onclick='remplirFormulaireClient(${JSON.stringify(client)})'>‚úèÔ∏è</button>
                            <button onclick='supprimerClient(${client.id})'>üóëÔ∏è</button>
                            <button onclick='afficherDetailsClient(${client.id})'>üëÅÔ∏è D√©tails</button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            });
        }

        function ajouterOuModifierClient() {
            const id = document.getElementById("id").value;
            const nom = document.getElementById("nom").value;
            const username = document.getElementById("username").value;
            const email = document.getElementById("email").value;
            const telephone = document.getElementById("telephone").value;

            const data = `nom=${encodeURIComponent(nom)}&username=${encodeURIComponent(username)}&email=${encodeURIComponent(email)}&telephone=${encodeURIComponent(telephone)}`;

            if (id) {
                ajax("PUT", `/clients/${id}`, data, () => {
                    resetFormClient();
                    chargerClients();
                });
            } else {
                ajax("POST", "/clients", data, () => {
                    resetFormClient();
                    chargerClients();
                });
            }
        }

        function remplirFormulaireClient(client) {
            document.getElementById("id").value = client.id;
            document.getElementById("nom").value = client.nom;
            document.getElementById("username").value = client.username;
            document.getElementById("email").value = client.email;
            document.getElementById("telephone").value = client.telephone;
        }

        function supprimerClient(id) {
            if (confirm("Supprimer ce client ?")) {
                ajax("DELETE", `/clients/${id}`, null, () => {
                    chargerClients();
                });
            }
        }

        function resetFormClient() {
            document.getElementById("id").value = "";
            document.getElementById("nom").value = "";
            document.getElementById("username").value = "";
            document.getElementById("email").value = "";
            document.getElementById("telephone").value = "";
        }

        function afficherDetailsClient(id) {
            window.location.href = `fiche-client.html?id=${id}`;
        }

        chargerClients();
    </script>
</body>
</html>